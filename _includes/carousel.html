{% assign letterstring = "a,b,c,d,e,f,g,h,i,j,k,l,m,n" %}
{% assign letters = letterstring | split: ',' %}
{% assign number = include.number | minus: 1 %}
{% assign items_count = page.carousels[number].images.size %}
<div class="carousel__holder" data-items-count="{{ items_count }}">
  {% for item in page.carousels[number].images %}
  <input class="carousel__activator" type="radio" name="carousel{{ number }}" id="{{ number }}{{ letters[forloop.index0] }}" {% if forloop.first %}checked="checked" {% endif %} />
  {% endfor %}
  {% if items_count > 1 %}
  <div class="carousel__dynamic-controls">
    {% for item in page.carousels[number].images %}
    {% if forloop.index == forloop.length %}
    {% assign nextindex = 0 %}
    {% else %}
    {% assign nextindex = forloop.index0 | plus: 1 %}
    {% endif %}
    {% assign nextletter = letters[nextindex] %}

    {% if forloop.index0 == 0 %}
    {% assign previndex = forloop.length | minus: 1 %}
    {% else %}
    {% assign previndex = forloop.index0 | minus: 1 %}
    {% endif %}
    {% assign prevletter = letters[previndex] %}

    <div class="carousel__control-set" data-slide="{{ forloop.index0 }}">
      <label class="control-background backward-bg" for="{{ number }}{{ prevletter }}">
        <div class="arrow-container">
          <span class="carousel__control carousel__control--backward"></span>
        </div>
      </label>
      <label class="control-background forward-bg" for="{{ number }}{{ nextletter }}">
        <div class="arrow-container">
          <span class="carousel__control carousel__control--forward"></span>
        </div>
      </label>
    </div>
    {% endfor %}
  </div>
  {% endif %}
  <div id="carousel{{ number }}" class="carousel">
    <div class="carousel__track">
      <ul>
        {% for item in page.carousels[number].images %}
        {% assign bg_mode = 'contain' %}
        {% if item.cover == true %}{% assign bg_mode = 'cover' %}{% endif %}
        <li class="carousel__slide" {% if item.image %}style="background-image: url('{{ item.image }}');" {% endif %}>
          <div class="media-wrapper">
          {% if item.image %}
          <div class="center_click" onclick="openModal('{{ item.image }}');"></div>
          {% elsif item.video %}
          {% assign video_parts = item.video | split: '?' %}
          {% assign video_id = video_parts[0] %}
          {% assign video_params = '' %}
          {% assign watch_params = '' %}
          {% if video_parts.size > 1 %}
            {% assign params = video_parts[1] | split: '&' %}
            {% assign watch_params = video_parts[1] %}
            {% for param in params %}
              {% assign kv = param | split: '=' %}
              {% if kv[0] == 't' %}
                {% assign video_params = video_params | append: '&start=' | append: kv[1] %}
              {% else %}
                {% assign video_params = video_params | append: '&' | append: param %}
              {% endif %}
            {% endfor %}
          {% endif %}
          {% if item.embebed == false or item.embed == false or item.embedded == false %}
          <a href="https://www.youtube.com/watch?v={{ video_id }}{% if watch_params != '' %}&{{ watch_params }}{% endif %}"
             target="_blank" rel="noopener" class="fake-player-link">
            <div class="video-bg" style="background-image: url('https://img.youtube.com/vi/{{ video_id }}/maxresdefault.jpg'); background-size: {{ bg_mode }};">
              {% if item.title %}<div class="video-title">{{ item.title }}</div>{% endif %}
              <div class="play-btn"></div>
            </div>
          </a>
          {% else %}
          <div class="youtube-container">
            <iframe width="100%" height="100%"
                    src="https://www.youtube-nocookie.com/embed/{{ video_id }}?origin={{ site.url | uri_escape }}{{ video_params }}"
                    frameborder="0"
                    allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; fullscreen"
                    referrerpolicy="no-referrer-when-downgrade"></iframe>
          </div>
          {% endif %}
          {% endif %}
          </div>
        </li>
        {% endfor %}
      </ul>
    </div>
    {% if items_count > 1 %}
    <div class="carousel__indicators">
      {% for item in page.carousels[number].images %}
      <label class="carousel__indicator" for="{{ number }}{{ letters[forloop.index0] }}"></label>
      {% endfor %}
    </div>
    {% endif %}
  </div>
</div>

<style>
:root { --min-arrow-size: 20px; --min-border-width: 3px; --size-scale-factor: calc(0.5vw + var(--min-arrow-size)); --border-scale-factor: calc(0.1vw + var(--min-border-width)); --play-btn-w:70px; --play-btn-h:50px; --play-tri-w:22px; --play-tri-h:16px; }
.carousel__track ul { margin:0; padding:0; list-style:none; }
.center_click { position:absolute; top:50%; left:50%; width:75%; height:75%; transform:translate(-50%, -50%); cursor:pointer; }
.youtube-container { position:absolute; width:100%; height:100%; top:0; left:0; z-index:4; }
.carousel__slide iframe { position:absolute; top:0; left:0; width:100%; height:100%; }
.carousel__holder { width:90%; position:relative; padding-bottom: {{ include.height }}{{ include.unit }}; margin:1rem auto; box-sizing:border-box; }
.carousel { position:absolute; inset:0; overflow:hidden; text-align:center; padding:0; box-sizing:border-box; }
.carousel__track { position:absolute; inset:0; padding:0; margin:0; transition:transform .5s ease; box-sizing:border-box; }
.media-wrapper { position:absolute; inset:0; display:flex; align-items:stretch; justify-content:center; }

.carousel__activator { position:absolute; opacity:0; width:0; height:0; pointer-events:none; }
{% for item in page.carousels[number].images %}
.carousel__activator:nth-of-type({{ forloop.index }}):checked ~ #carousel{{ number }} .carousel__track { transform:translateX(-{{ forloop.index0 }}00%); }
.carousel__activator:nth-of-type({{ forloop.index }}):checked ~ #carousel{{ number }} .carousel__track .carousel__slide:nth-of-type({{ forloop.index }}) { opacity:1; }
.carousel__activator:nth-of-type({{ forloop.index }}):checked ~ #carousel{{ number }} .carousel__indicators .carousel__indicator:nth-of-type({{ forloop.index }}) { opacity:1; background-color:#fff; box-shadow:0 0 8px rgba(255,255,255,.8); transform:scale(1.2); }
.carousel__activator:nth-of-type({{ forloop.index }}):checked ~ .carousel__dynamic-controls .carousel__control-set[data-slide="{{ forloop.index0 }}"] { display:block; }
{% endfor %}

.carousel__slide { height:100%; position:absolute; top:0; left:0; width:100%; opacity:0; overflow:hidden; box-sizing:border-box; }
{% for item in page.carousels[number].images %}
.carousel__track .carousel__slide:nth-of-type({{ forloop.index }}) { transform:translateX({{ forloop.index0 }}00%); }
{% endfor %}

.carousel__indicators { cursor:pointer; position:absolute; bottom:10px; width:90%; margin-left:5%; left:0; text-align:center; z-index:3; pointer-events:none; background-color:rgba(255,255,255,.7); padding:8px 0; border-radius:20px; box-shadow:0 2px 5px rgba(0,0,0,.3); }
.carousel__indicator { height:15px; width:15px; border-radius:100%; display:inline-block; cursor:pointer; opacity:.6; margin:0 5px; pointer-events:auto !important; background-color:#fafafa; box-shadow:0 0 3px rgba(0,0,0,.5); transition:.3s; }
.carousel__indicator:hover { opacity:.9; transform:scale(1.2); }
.control-background { position:absolute; width:50px; height:80px; border-radius:5px; z-index:5; cursor:pointer; display:flex; justify-content:center; align-items:center; }
.arrow-container { display:flex; justify-content:center; align-items:center; width:100%; height:100%; position:relative; }
.carousel__control { height:var(--size-scale-factor); width:var(--size-scale-factor); display:block; border-width:var(--border-scale-factor) var(--border-scale-factor) 0 0; border-style:solid; border-color:#fafafa; opacity:1; position:absolute; pointer-events:none; }
.carousel__control--backward { transform:rotate(-135deg); left:calc(50% - (var(--size-scale-factor)/2 - var(--border-scale-factor))); top:calc(50% - var(--size-scale-factor)/2); }
.carousel__control--forward { transform:rotate(45deg); left:calc(50% - (var(--size-scale-factor)/2 + var(--border-scale-factor))); top:calc(50% - var(--size-scale-factor)/2); }
.carousel__dynamic-controls { position:absolute; width:100%; height:100%; top:0; left:0; z-index:999; pointer-events:none; }
.carousel__dynamic-controls .carousel__control-set { display:none; position:absolute; width:100%; height:100%; top:0; left:0; }
.carousel__control:hover { opacity:.7; }
.carousel__dynamic-controls .carousel__control { pointer-events:auto !important; }
.carousel__holder[data-items-count="1"] .carousel__dynamic-controls,
.carousel__holder[data-items-count="1"] .carousel__indicators { display:none !important; }
.fake-player-link { position:absolute; inset:0; margin:0; padding:0; text-decoration:none !important; border-bottom:none !important; cursor:pointer !important; }
.fake-player-link:hover { text-decoration:none !important; }
.video-bg { position:absolute; inset:0; width:100%; height:100%; background-position:center; background-color:#000; background-repeat:no-repeat; overflow:hidden; box-shadow:0 4px 10px rgba(0,0,0,.3); }
.video-title { position:absolute; top:0; left:0; width:100%; padding:12px 16px; color:#fff; font-size:16px; font-weight:500; line-height:1.2; text-shadow:0 1px 2px rgba(0,0,0,.6); background:linear-gradient(to bottom, rgba(0,0,0,.7) 0%, rgba(0,0,0,0) 100%); z-index:5; }
.play-btn { position:absolute; top:50%; left:50%; transform:translate(-50%, -50%); width:var(--play-btn-w); height:var(--play-btn-h); background-color:rgba(33,33,33,.8); border-radius:12px; display:flex; align-items:center; justify-content:center; z-index:10; cursor:pointer; }
.play-btn::before { content:""; display:block; width:0; height:0; border-left:var(--play-tri-w) solid #fff; border-top:var(--play-tri-h) solid transparent; border-bottom:var(--play-tri-h) solid transparent; margin-left:4px; }
.fake-player-link:hover .play-btn { background-color:#f00; }
@media (max-width:640px){ :root { --play-btn-w:64px; --play-btn-h:46px; --play-tri-w:20px; --play-tri-h:14px; } }
</style>

<script>
function isVisible(el){ while(el){ if(el===document){ return true;} var $s=window.getComputedStyle(el,null); if(!$s){return false;} if($s.display==='none'||$s.visibility==='hidden'||+$s.opacity===0){return false;} if(($s.display==='block'||$s.display==='inline-block')&&$s.height==='0px'&&$s.overflow==='hidden'){return false;} el=el.parentNode; } return true; }
{% if include.duration %}
setInterval(function(){ var j=0; var elements=document.querySelectorAll('#carousel{{ number}} .carousel__control--forward'); for(i=(elements.length-1); i>-1; i--){ if(isVisible(elements[i])) j=i; } elements[j].click(); }, {{ include.duration }}000);
{% endif %}
</script>
<script src="{{ '/assets/carousel.js' | relative_url }}"></script>
